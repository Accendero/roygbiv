<!--
Design:
	+ brain.js : service for showing a clickable, colored brain.
	+ navigator.js : controller for the brain navigator
	  => depends on brain.js
	+ plotter.js : controller for the plotting
	  => must be told what function to use to plot, in the constructor.
	  => function may depend on brain.js, but controller does NOT
-->
<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js webgl - loaders - vtk loader</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<link rel="stylesheet" type="text/css" href="css/style.css" />
		<style>
			#plot-canvas {
				width: 200px;
				height: 200px;
			}
		</style>

		<script src="js/libs/three.min.js"></script>
		<script src="js/libs/Projector.js"></script>
		<script src="js/libs/Detector.js"></script>
		<script src="js/libs/TrackballControls.js"></script>
		<script src="js/libs/VTKLoader.js"></script>
		<!--<script src="js/libs/Detector.js"></script>
		<script src="js/libs/stats.min.js"></script>-->
		<script src="js/libs/jquery.min.js"></script>
		<script src="js/libs/d3.min.js"></script>
		<script src="js/libs/box.js"></script>
		<script src="js/libs/angular.min.js"></script>

		<script src="js/brain.js"></script>
		<script src="js/hemiplot.js"></script>
	</head>

	<body>
		<div ng-app="navigator" ng-controller="NavigateController" ng-strict-di>
			<div id="header_n_label">
				<h1>ROYGBIV</h1>
				<div id="nav_label">
					Shift+click on a label to highlight the area in the RH.
					<br />
					<br />
					Selected Label:
					<span ng-if="mesh.name">{{ mesh.name }}</span>
					<span ng-if="mesh">
						{{ mesh.value.0 | number:4}}
					</span>
				</div>
				<div id="plot-canvas" ng-if="mesh">
				</div>
			</div>
			<div id="demo-links">other demos: <a href="index.html">Box plot</a></div>
            <div style="width:600px; background-color:green; float: right;">
                <style>
                    span {
                        float: left;
                        width: 150px;
                    }
                    .selection-label{
                        width: 75px;
                        font-family: arial;
                        float:left;
                    }
                    input {
                        float: left;
                        margin: 3px 10px 0px 10px;
                    }
                    p {
                    }
                </style>
                <p>
                    <span class="selection-label">Surface:</span>
                    <input ng-model='metadata.surf_type' type="radio" name="surf_type" value="pial"></input><span>Pial</span>
                    <input ng-model='metadata.surf_type' type="radio" name="surf_type" value="inflated" {% if $scope.mesh %}checked{% endif %}><span>Inflated</span>
                </p><br/>
                <p>
                    <span class="selection-label">Atlas:</span>
                    <input ng-model='metadata.atlas' type="radio" name="atlas" value="desikan"></input><span>Desikan (36 ROIs)</span>
                    <input ng-model='metadata.atlas' type="radio" name="atlas" value="destrieux">Destrieux (76 ROIs)</input>
                </p>
                <p>
                    <span class="selection-label">Measure:</span>
                    <input ng-model='metadata.measure' type="radio" name="measure" value="thickness"></input><span>Thickness</span>
                    <input ng-model='metadata.measure' type="radio" name="measure" value="area"><span>Surface area</span>
                </p>
            </div>
			<div id="nav-brain">
			</div>
		</div>

		<script>
			angular.module('navigator', [])
			.controller('NavigateController', ['$scope', function($scope) {
				$scope.metadata = {
					measure: 'thickness',
					atlas: 'destrieux',
					surf_type: 'pial',
					subject: 'fsaverage',
					prefix: 'Destrieux_area.'
				};
				$scope.manifest_url = 'data/lh_files_to_load.json';

                $scope.brain = new Brain({
                    divID: "nav-brain",
                    callback: function(mesh) {
                    	$scope.mesh = mesh;
                        $scope.$apply();
                        if (mesh) {
                            do_hemiplot("plot-canvas", mesh);
                        }
                    },
                    manifest: $scope.manifest_url
                });
                window.$scope = $scope;
                window.brain = $scope.brain;
                // Use the relatively new watchCollection().
                $scope.$watchCollection("metadata", function( newValue, oldValue ) {
					var prefixes = {
						desikan: { area: 'MRI_cort_area.ctx.', thickness: 'MRI_cort_thick.ctx.'},
						destrieux: { area: 'Destrieux_area.', thickness: 'Destrieux_thickness.'}
					}
					$scope.metadata.prefix = prefixes[newValue.atlas][newValue.measure];
					var base_url = 'http://127.0.0.1:5000/' + $scope.metadata.subject + '/'
								    + $scope.metadata.atlas + '/' + $scope.metadata.surf_type + '/'
								    + $scope.metadata.prefix + '/';
					var manifest_url = base_url + 'data/lh_files_to_load.json';
					if (manifest_url != $scope.manifest_url) {
						$scope.manifest_url = manifest_url;
						// Update the brain
						$scope.brain.loadBrain($scope.manifest_url);
					}
				});



			}]);
		</script>
	</body>
</html>
