<html>
	<body> 
	hello world
	</body>
	
	<style>
		html, body { 
		  background-color:#000;
		  margin: 0;
		  padding: 0;
		  height: 100%;
		  overflow: hidden !important;  
		}
		
	</style>
	
	<script type="text/javascript" src="http://get.goXTK.com/xtk.js"></script>
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<script src="js/viz.js" charset="utf-8"></script>
	<!--<script src="http://get.goxtk.com/xtk_edge.js"></script>-->
	<script src="http://get.goxtk.com/xtk_xdat.gui.js"></script>

	<script type="text/javascript">
		window.onload = function() {
		
		  // create and initialize a 3D renderer
		var r = new X.renderer3D();
		r.init();
		
		
		// create a new X.mesh
		mesh = new X.mesh();
		// change the color to grey
		mesh.color = [0.5, 0.5, 0.5];
		// and attach a freesurfer mesh
		//mesh.file = 'http://x.babymri.org/?lefthemisphere.smoothwm';
		mesh.file = "http://media.mindboggle.info/vis/data/mindboggled/Twins-2-1/xtra/lh.pial"
		//mesh.file = "http://media.mindboggle.info/vis/symmetric.smoothwm"
		
		// load curvature values from a .crv file
		// it would also be possible to create an X.scalars object and
		// configure an array using 'X.scalars.array = arr;' to be independent from a
		// file format
		//arr = d3.csv.parse()
		//mesh.scalars.array = scalars
		// in this case we choose the 'C' curvature as the default
		//mesh.scalars.file = "http://media.mindboggle.info/vis/data/mindboggled/Twins-2-1/xtra/lh.curv"//"http://media.mindboggle.info/vis/data/mindboggled/Twins-2-1/labels/left_cortical_surface/freesurfer_cortex_labels.vtk"
		mesh.scalars.file = 'http://media.mindboggle.info/vis/notebooks/geodesic_depth.crv'//'http://x.babymri.org/?lh.smoothwm.C.crv';
		// we want to map the scalars linear between blue and white
		mesh.scalars.minColor = [0, 0, 1];
		mesh.scalars.maxColor = [1, 1, 1];
		
		// .. add the mesh
		r.add(mesh);
		
		// .. and start the loading/rendering
		r.render();

		
		
	// The GUI
  //
  gui = null; // we need to re-load the gui after we change the curvature type
  
  // here are the available curvature types (looks a little cryptic but is just
  // text) and files
  //curvatureTypes = ['C (mm&#x207b;&sup2;)', 'k&#x2081; (mm&#x207b;&sup1;)',
  //                  'H (mm&#x207b;&sup1;)'];
  
  curvatureFiles = ["area.crv", "freesurfer_convexity_(sulc).crv",  
                    "freesurfer_curvature.crv", "freesurfer_thickness.crv",
                    "fundus_ID.crv", "geodesic_depth.crv", "label_ID.crv",
                    "mean_curvature.crv",  "sulcus_ID.crv",  "travel_depth.crv"]
                    
  curvatureTypes = ["area","convexity (sulc)","curvature","thickness",
                    "fundus","geodesic depth", "label ID", "mean curvature", 
                    "sulcus ID", "travel depth"]
  
  
  //['lh.smoothwm.C.crv', 'lh.smoothwm.K1.crv',
                    //'lh.smoothwm.H.crv'];
  
  // we need this Loader as a container to keep track of the current curvature
  var _loader = {
    
    // default type
    Type: 'geodesic depth'
  
  };
  
  // the onShowtime method gets executed after all files were fully loaded and
  // just before the first rendering attempt
  	r.onShowtime = function() {

    if (gui) {
      
      // if we already have a gui, destroy it
      // .. it will be re-created immediately
      gui.destroy();
      gui = null;
      
    }
    
    //
    // create the GUI panel
    //
    gui = new dat.GUI();
    var meshgui = gui.addFolder('Mesh');
    var meshColorController = meshgui.addColor(mesh, 'color');
    meshgui.open();
    
    var curvgui = gui.addFolder('Curvature');
    // a combobox for the different curvature types
    var typeController = curvgui.add(_loader, 'Type', curvatureTypes);
    // the min and max color which define the linear gradient mapping
    var minColorController = curvgui.addColor(mesh.scalars, 'minColor');
    var maxColorController = curvgui.addColor(mesh.scalars, 'maxColor');
    // controllers to threshold the scalars
    var minThresholdController = curvgui.add(mesh.scalars, 'lowerThreshold',
        mesh.scalars.min, mesh.scalars.max);
    var maxThresholdController = curvgui.add(mesh.scalars, 'upperThreshold',
        mesh.scalars.min, mesh.scalars.max);
    curvgui.open();
    
    //
    // Change the curvature type callback
    //
    typeController.onChange(function(value) {

      var _index = curvatureTypes.indexOf(value);
      
      // we need to buffer the (maybe changed) colors
      // else wise we would start with the default red<->green mapping
      var oldMinColor = mesh.scalars.minColor;
      var oldMaxColor = mesh.scalars.maxColor;
      
      // now we (re-)load the selected curvature file
      mesh.scalars.file = 'http://media.mindboggle.info/vis/notebooks/' + curvatureFiles[_index];
      mesh.modified();
      
      mesh.scalars.minColor = oldMinColor;
      mesh.scalars.maxColor = oldMaxColor;
      
    });	
    };



//CLICKS AND STUFF

	r.interactor.onMouseDown = function(left, middle, right) {
	
	    // only observe right mouse clicks        
	    if (!right) return;
	
	    // grab the current mouse position
	    var _pos = r.interactor.mousePosition;
	
	    // pick the current object
	    var _id = r.pick(_pos[0], _pos[1]);
		
		console.log("mesh id ist",mesh.id)
		
	    if (_id == mesh.id) {
	
	        // turn the sphere green
	        //sphere.color = [0, 1, 0];
	        //r.render();
	        alert("clicked the brain!")
	
	    }
	    //alert("you clicked!")
	    console.log("id is", _id)
	    console.log("position is",_pos)
	
	}

		
		console.log(r.interactor)
		
};

</script>
	
	
</html>
